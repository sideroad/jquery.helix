!function(a){var b=function(a,b){a.removeClass("show first last focus"),a.filter(":lt("+parseInt(b.devide*b.turns,10)+")").addClass("show"),a.filter(":first").addClass("first"),a.filter(":eq("+b.half+")").addClass("focus"),a.filter(":eq("+parseInt(b.devide*b.turns-1,10)+")").addClass("last")},c=function(c){var d=c.addClass("helix").children(),e=a.extend({width:c.width(),height:c.height(),item:{width:d.width(),height:d.height()},devide:10,turns:1.5,margin:"50%"},arguments[1],!0),f=function(a){var b=e.item.width;return/%$/.test(a)&&(a=b*a.substr(0,a.length-1)/100),b+a}(e.margin),g=d.length,h=e.devide>g?g:e.devide,i=0,j=360/h,k=Math.round(f/2/Math.tan(Math.PI/h)),l=0,m=parseInt(h*e.turns/2,10),n=a("<div class='helix-container' ></div>").css({"-webkit-perspective":e.width,perspective:e.width,width:e.item.width,height:e.height}),o=(m+h%2)*j,p=e.height,q=p/2-e.item.height/2,r=-p/(2*e.turns),s=(q-r)/m,t={distance:j,length:g,size:f,children:d,translateZ:k,rotateY:o,focus:m,turns:e.turns,first:0,last:d.length-1,half:m,ramp:s,devide:h,height:p,start:r};return d.filter(":gt("+parseInt(g-m-1+g%2,10)+")").prependTo(c),d=c.children(),d.each(function(){var b=a(this);b.css({transform:"rotateY( "+parseInt(i,10)+"deg ) translateZ( "+k+"px )"}).transition({y:r+l*s}),i+=j,l++}),b(d,t),c.wrap(n),c.css({transform:"translateY(0px) translateZ( -"+k+"px ) rotateY("+parseInt(-1*o,10)+"deg)",width:e.item.width}).show().data(t),c},d=function(a,c){var d=a.data(),e=d.children,f=d.distance,g=d.translateZ,h=d.rotateY,i=(d.length,d.focus),j=d.first,k=d.last,l=(d.half,d.ramp),m=(d.height,d.devide,d.start);h+=f*c,i+=c,k+=c,j+=c,e=a.children(),1===c?e.filter(":first").transition({y:m+k*l,rotateY:k*f,duration:0}).appendTo(a):e.filter(":last").transition({y:m+j*l,rotateY:j*f,duration:0}).prependTo(a),b(a.children(),d),a.css("transform","translateY("+j*l*-1+"px) translateZ( -"+g+"px ) rotateY("+parseInt(-1*h,10)+"deg)").data({rotateY:h,children:e,focus:i,first:j,last:k})},e=function(a){d(a,1)},f=function(a){d(a,-1)};a.fn.helix=function(a){return"next"===a?e(this):"prev"===a?f(this):c(this,a)}}(jQuery);